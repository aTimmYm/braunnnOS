local c = require("cfunc")
local _obj = {}

local function New_Object(bg)
    local Obj = {}
    Obj.pos = {x=1,y=1}
    Obj.size = {w=1,h=1}
    Obj.bg = bg or colors.black
    Obj.dirty = true
    Obj.parent = nil

    Obj.onKeyDown = function (self,key,held) return true end
    Obj.onKeyUp = function (self,key) return true end
    Obj.onCharTyped = function (self,chr) return true end
    Obj.onPaste = function (self,text) return true end
    Obj.onMouseDown = function (self,btn,x,y) return true end
    Obj.onMouseUp = function (self,btn,x,y) return true end
    Obj.onMouseScroll = function (self,dir,x,y) return true end
    Obj.onMouseDrag = function (self,btn,x,y) return true end
    Obj.onFocus = function (self,focused) return true end
    Obj.draw = function (self) end
    Obj.redraw = function (self)
        if self.dirty then self:draw() self.dirty = false end
    end
    Obj.onEvent = function (self,evt)
        if evt[1] == "mouse_drag" then
            return self:onMouseDrag(evt[2],evt[3],evt[4])
        elseif evt[1] == "mouse_up" then
            return self:onMouseUp(evt[2],evt[3],evt[4])
        elseif evt[1] == "mouse_click" then
            if self.root then self.root.focus = self end
            return self:onMouseDown(evt[2],evt[3],evt[4])
        elseif evt[1] == "mouse_scroll" then
            return self:onMouseScroll(evt[2],evt[3],evt[4])
        elseif evt[1] == "char" then
            return self:onCharTyped(evt[2])
        elseif evt[1] == "key" then
            return self:onKeyDown(evt[2],evt[3])
        elseif evt[1] == "key_up" then
            return self:onKeyUp(evt[2])
        elseif evt[1] == "paste" then
            return self:onPaste(evt[2])
        end
        return false
    end
    return Obj
end

function _obj.New_Board()
    local Board = New_Object()
    Board.childs = {}

    Board.addChild = function (self,child)
        table.insert(self.childs,child)
        child.parent = self
    end
    return Board
end

return _obj